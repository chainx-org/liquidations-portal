!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("debug"),require("lodash-es/uniq"),require("lodash-es/values"),require("toposort")):"function"==typeof define&&define.amd?define(["exports","debug","lodash-es/uniq","lodash-es/values","toposort"],e):e((t=t||self)["@makerdao/services-core"]={},t.debug,t.uniq,t.values,t.toposort)}(this,(function(t,e,n,r,i){"use strict";function o(t,e,n,r,i,o,a){try{var c=t[o](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(r,i)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function c(t){o(a,r,i,c,s,"next",t)}function s(t){o(a,r,i,c,s,"throw",t)}c(void 0)}))}}function c(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,u(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function f(t,e,n){return(f=h()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&u(i,n.prototype),i}).apply(null,arguments)}function l(t){var e="function"==typeof Map?new Map:void 0;return(l=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return f(t,arguments,s(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),u(n,t)})(t)}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function p(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return d(t,void 0);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,void 0):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i;var v=function(t){function e(){return t.apply(this,arguments)||this}return c(e,t),e}(l(Error)),y=function(){function t(t,e){if("object"!=typeof e)throw new Error("StateMachine transitions parameter must be an object.");if(Object.keys(e).filter((function(t){return e.hasOwnProperty(t)&&!(e[t]instanceof Array)})).length>0)throw new Error("Illegal StateMachine transition found: not an array.");if(Object.keys(e).filter((function(t){return e.hasOwnProperty(t)&&e[t].filter((function(t){return!e[t]})).length>0})).length>0)throw new Error("Illegal StateMachine transition found: target state not in transition map.");if(!(e[t]instanceof Array))throw new Error("Initial state "+t+" is not set in the transitions map.");this._state=t,this._nextStates=e,this._stateChangedHandlers=[]}var e=t.prototype;return e.onStateChanged=function(t){this._stateChangedHandlers.push(t)},e.state=function(){return this._state},e.inState=function(t){return t instanceof Array||(t=[t]),t.indexOf(this._state)>=0},e.assertState=function(t,e){if(void 0===e&&(e=""),!this.inState(t))throw new v("Illegal operation for state "+this._state+(e.length>0?": "+e:""))},e.transitionTo=function(t){if(void 0===this._nextStates[t])throw new v("Cannot set illegal state: "+t);if(t!==this._state){if(this._nextStates[this._state].indexOf(t)<0)throw new v("Illegal state transition: "+this._state+" to "+t);var e=this._state;this._state=t,this._stateChangedHandlers.forEach((function(n){return n(e,t)}))}return this},t}(),g={LOCAL:"LOCAL",PUBLIC:"PUBLIC",PRIVATE:"PRIVATE"},E={LOCAL:{CREATED:["INITIALIZING"],INITIALIZING:["CREATED","READY"],READY:["ERROR"],ERROR:[]},PUBLIC:{CREATED:["INITIALIZING"],INITIALIZING:["CREATED","OFFLINE"],OFFLINE:["CONNECTING"],CONNECTING:["OFFLINE","READY"],READY:["OFFLINE","ERROR"],ERROR:[]},PRIVATE:{CREATED:["INITIALIZING"],INITIALIZING:["CREATED","OFFLINE"],OFFLINE:["CONNECTING"],CONNECTING:["OFFLINE","ONLINE"],ONLINE:["OFFLINE","AUTHENTICATING"],AUTHENTICATING:["ONLINE","READY"],READY:["OFFLINE","ONLINE","ERROR"],ERROR:[]}},m=e("dai:ServiceManagerBase");function I(t){return new Promise((function(e,n){try{e(t())}catch(t){n(t.message)}}))}var _=function(){function t(t,e,n){if(void 0===t&&(t=null),void 0===e&&(e=null),void 0===n&&(n=null),null!==t&&"function"!=typeof t)throw new Error("Invalid argument init: not a function or null.");if(null===t&&(t=function(){return Promise.resolve()}),null!==e&&"function"!=typeof e)throw new Error("Invalid argument connect: not a function or null.");if(null===e&&null!==n&&(e=function(){return Promise.resolve()}),null!==n&&"function"!=typeof n)throw new Error("Invalid argument auth: not a function or null.");this._init=t,this._connect=e,this._auth=n,this._type=null===n?null===e?g.LOCAL:g.PUBLIC:g.PRIVATE,this._state=new y("CREATED",E[this._type]),this._initPromise=null,this._connectPromise=null,this._authPromise=null}var e=t.prototype;return e.initialize=function(t){var e=this;if(this._state.inState("CREATED")){if(this._initPromise)throw new Error("Unexpected init promise in state CREATED.");this._state.transitionTo("INITIALIZING"),this._initPromise=I((function(){return e._init(t)})).then((function(){return e._state.transitionTo(e._type===g.LOCAL?"READY":"OFFLINE")}),(function(t){throw m(t),e._state.transitionTo("CREATED"),t}))}return this._initPromise},e.connect=function(){var t=this;return this._type===g.LOCAL?this.initialize():(this._state.inState(["CREATED","INITIALIZING","OFFLINE"])&&null===this._connectPromise&&(this._connectPromise=this.initialize().then((function(){return t._state.transitionTo("CONNECTING"),I((function(){return t._connect((function(){return t._disconnect()}))})).then((function(){t._state.inState("CONNECTING")&&t._state.transitionTo(t._type===g.PUBLIC?"READY":"ONLINE")}),(function(e){throw m("connect error:",e),t._state.inState("CONNECTING")&&t._state.transitionTo("OFFLINE"),e}))}))),this._connectPromise)},e.authenticate=function(){var t=this;return this._type!==g.PRIVATE?this.connect():(this._state.inState(["CREATED","INITIALIZING","OFFLINE","CONNECTING","ONLINE"])&&null===this._authPromise&&(this._authPromise=this.connect().then((function(){return t._state.transitionTo("AUTHENTICATING"),I((function(){return t._auth((function(){return t._deauthenticate()}))})).then((function(){t._state.inState("AUTHENTICATING")&&t._state.transitionTo("READY")}),(function(e){m("authenticate error: "+e),t._state.inState("AUTHENTICATING")&&t._state.transitionTo("ONLINE")}))}))),this._authPromise)},e.settings=function(t){return this._settings=t,this},e.state=function(){return this._state.state()},e.type=function(){return this._type},e.isInitialized=function(){return!this._state.inState(["CREATED","INITIALIZING"])},e.isConnected=function(){return this._type===g.LOCAL?null:this._state.inState(["ONLINE","AUTHENTICATING","READY"])},e.isAuthenticated=function(){return this._type===g.PRIVATE?this._state.inState("READY"):null},e.isReady=function(){return this._state.inState("READY")},e.onInitialized=function(t){return this._state.onStateChanged((function(e,n){"INITIALIZING"!==e||"OFFLINE"!==n&&"READY"!==n||t()})),this},e.onConnected=function(t){return this._state.onStateChanged((function(e,n){"CONNECTING"!==e||"ONLINE"!==n&&"READY"!==n||t()})),this},e.onDisconnected=function(t){return this._state.onStateChanged((function(e,n){"OFFLINE"!==n||"ONLINE"!==e&&"READY"!==e||t()})),this},e.onAuthenticated=function(t){return this._state.onStateChanged((function(e,n){"AUTHENTICATING"===e&&"READY"===n&&t()})),this},e.onDeauthenticated=function(t){return this.type()===g.PRIVATE&&this._state.onStateChanged((function(e,n){"OFFLINE"!==n&&"ONLINE"!==n||"READY"!==e||t()})),this},e.onReady=function(t){return this._state.onStateChanged((function(e,n){"READY"===n&&t()})),this},e.onStateChanged=function(t){return this._state.onStateChanged(t),this},e._disconnect=function(){if(this._type===g.LOCAL)throw new Error("_disconnect must not be called on a Local Service");this._state.inState("AUTHENTICATING")&&this._deauthenticate(),this._state.inState(["READY","ONLINE","CONNECTING"])&&(this._authPromise=null,this._connectPromise=null,this._state.transitionTo("OFFLINE"))},e._deauthenticate=function(){if(this._type!==g.PRIVATE)throw new Error("_deauthenticate must not be called on a Local or Public Service");this._state.inState(["READY","AUTHENTICATING"])&&(this._authPromise=null,this._state.transitionTo("ONLINE"))},t}(),w=function(t){function e(e){return t.call(this,e)||this}return c(e,t),e}(l(Error)),N=function(t){function e(e,n){return t.call(this,"Injected service "+n+" is not a dependency of "+e)||this}return c(e,t),e}(l(Error)),A=function(t){function e(e,n){return t.call(this,"Dependency "+n+" of service "+e+" is unavailable.")||this}return c(e,t),e}(l(Error));function T(t){return Promise.all(this.dependencies().map((function(e){return t(e)})))}var L=function(t){function e(e,n,r,i,o){var a;if(void 0===n&&(n=[]),void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null),a=t.call(this,r,i,o)||this,!e)throw new Error("Service name must not be empty.");return a._name=e,a._dependencies=n,a._injections={},n.forEach((function(t){return a._injections[t]=null})),a}c(e,t),e.isValidService=function(t){return null!==t&&"object"==typeof t&&"function"==typeof t.manager};var n=e.prototype;return n.name=function(){return this._name},n.dependencies=function(){return this._dependencies},n.inject=function(t,n){if(void 0===this._injections[t])throw new N(this.name(),t);if(!e.isValidService(n))throw new w("Cannot inject invalid service in "+this.name());return this._injections[t]=n,this},n.dependency=function(t){if(!this._injections[t])throw new A(this.name(),t);return this._injections[t]},n.initialize=function(){var e=this;return this.initializeDependencies().then((function(){return t.prototype.initialize.call(e,e._settings)}))},n.connect=function(){var e=this;return this.connectDependencies().then((function(){return t.prototype.connect.call(e)}))},n.authenticate=function(){var e=this;return this.authenticateDependencies().then((function(){return t.prototype.authenticate.call(e)}))},n.initializeDependencies=function(){var t=this;return T.call(this,(function(e){return t.dependency(e).manager().initialize()}))},n.connectDependencies=function(){var t=this;return T.call(this,(function(e){return t.dependency(e).manager().connect()}))},n.authenticateDependencies=function(){var t=this;return T.call(this,(function(e){return t.dependency(e).manager().authenticate()}))},n.createService=function(){var t=this;return{manager:function(){return t}}},e}(_);function O(t){void 0===this.initialize&&(this.initialize=function(){}),t!==g.LOCAL&&(void 0===this.connect&&(this.connect=function(){}),this.disconnect=function(){}),t===g.PRIVATE&&(void 0===this.authenticate&&(this.authenticate=function(){}),this.deauthenticate=function(){})}function b(t,e,n){var r=this;return new L(e,n,(function(t){return r.initialize(t)}),t===g.LOCAL?null:function(t){return r.disconnect=t,r.connect()},t!==g.PRIVATE?null:function(t){return r.deauthenticate=t,r.authenticate()})}function C(t){var e=this;t.onInitialized((function(){t.type()!==g.LOCAL&&t.dependencies().forEach((function(t){e.get(t).manager().onDisconnected((function(){return e.disconnect()}))})),t.type()===g.PRIVATE&&t.dependencies().forEach((function(t){e.get(t).manager().onDeauthenticated((function(){return e.deauthenticate()}))}))}))}function S(){var t={initialize:this.initialize,connect:this.connect,authenticate:this.authenticate};this.initialize=function(e){if("INITIALIZING"!==this.manager().state())throw new Error("Expected state INITIALIZING, but got "+this.manager().state()+". Did you mean to call service.manager().initialize() instead of service.initialize()?");return t.initialize.apply(this,[e])},void 0!==t.connect&&(this.connect=function(){if("CONNECTING"!==this.manager().state())throw new Error("Expected state CONNECTING, but got "+this.manager().state()+". Did you mean to call service.manager().connect() instead of service.connect()?");return t.connect.apply(this)}),void 0!==t.authenticate&&(this.authenticate=function(){if("AUTHENTICATING"!==this.manager().state())throw new Error("Expected state AUTHENTICATING, but got "+this.manager().state()+". Did you mean to call service.manager().authenticate() instead of service.authenticate()?");return t.authenticate.apply(this)})}var R=function(){function t(t,e,n){if(void 0===n&&(n=[]),e||(e=this.constructor.role),this.constructor.dependencies&&(n=this.constructor.dependencies),void 0===g[t])throw new Error("Invalid ServiceType: "+t);O.call(this,t),this._serviceManager=b.call(this,t,e,n),C.call(this,this._serviceManager),S.call(this)}var e=t.prototype;return e.manager=function(){return this._serviceManager},e.get=function(t){return this._serviceManager.dependency(t)},t}();function P(t,e,n){if(e instanceof Array)return"boolean"==typeof e[0]&&n?[x(t,e[0],n),e[1]]:e;var r,i={};switch(typeof e){case"string":case"function":r=e;break;case"object":e instanceof R?r=e:(r=!n||x(t,!0,n),i=e);break;case"boolean":r=n?x(t,e,n):e;break;default:throw new Error("could not parse settings for "+t+": "+JSON.stringify(e))}return[r,i]}function x(t,e,n){var r,i=n.disabled;if(e){if(!(r=n.defaults[t]))throw new Error('The "'+t+'" service has no default')}else if(!(r=i[t]))throw new Error('The "'+t+'" service cannot be disabled');return r}function D(t,e){return t(e={exports:{}},e.exports),e.exports}var j=D((function(t){var e=function(t){var e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n,r){var i=Object.create((e&&e.prototype instanceof h?e:h).prototype),o=new w(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var c=m(a,n);if(c){if(c===u)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var h=s(t,e,n);if("normal"===h.type){if(r=n.done?"completed":"suspendedYield",h.arg===u)continue;return{value:h.arg,done:n.done}}"throw"===h.type&&(r="completed",n.method="throw",n.arg=h.arg)}}}(t,n,o),i}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var u={};function h(){}function f(){}function l(){}var d={};d[i]=function(){return this};var p=Object.getPrototypeOf,v=p&&p(p(N([])));v&&v!==e&&n.call(v,i)&&(d=v);var y=l.prototype=h.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function E(t,e){var r;this._invoke=function(i,o){function a(){return new e((function(r,a){!function r(i,o,a,c){var u=s(t[i],t,o);if("throw"!==u.type){var h=u.arg,f=h.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(f).then((function(t){h.value=t,a(h)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function m(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,m(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,u;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function N(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}return f.prototype=y.constructor=l,l.constructor=f,l[a]=f.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,a in t||(t[a]="GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},g(E.prototype),E.prototype[o]=function(){return this},t.AsyncIterator=E,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new E(c(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(y),y[a]="Generator",y[i]=function(){return this},y.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=N,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(c&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),_(n),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;_(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:N(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}})),F=function(t){function e(e){return t.call(this,"Service with name '"+e+"' is already registered with this container.")||this}return c(e,t),e}(l(Error)),G=function(t){function e(e){return t.call(this,"Service with name '"+e+"' cannot be found in this container.")||this}return c(e,t),e}(l(Error)),k=function(t){function e(e){return t.call(this,"Service with name '"+e+"' has been extracted from the core dai.js library into a discrete plugin. Please refer to the documentation here to install and add it to your configuration: \n\n https://github.com/makerdao/dai.js/wiki/Basic-Usage-(Plugins) \n\n")||this}return c(e,t),e}(l(Error));function z(t){for(var e,r=[],o=[],a=function(){var t=e.value,n=t.manager().name(),i=t.manager().dependencies();0===i.length?o.push(n):i.forEach((function(t){return r.push([t,n])}))},c=p(t);!(e=c()).done;)a();return n(i(r).concat(o))}var U=function(){function t(){this._services={},this.isAuthenticated=!1}var e=t.prototype;return e.register=function(t,e){if(void 0===e&&(e=null),!L.isValidService(t))throw new w("Service must be an object with manager() method returning a valid ServiceManager");e=e||t.manager().name();var n=this.service(e,!1);if(void 0!==n&&n!==t)throw new F(e);return this._services[e]=t,this},e.service=function(t,e){if(void 0===e&&(e=!0),!t)throw new Error("Provide a service name.");if(!this._services[t]&&e&&["exchange"].includes(t))throw new k(t);if(!this._services[t]&&e)throw new G(t);return this._services[t]},e.getRegisteredServiceNames=function(){return Object.keys(this._services)},e.injectDependencies=function(){for(var t,e=p(r(this._services));!(t=e()).done;)for(var n,i=t.value.manager(),o=p(i.dependencies());!(n=o()).done;){var a=n.value;if(!this._services[a])throw new G(a);i.inject(a,this._services[a])}},e.initialize=function(){return this._waitForServices((function(t){return t.manager().initialize()}))},e.connect=function(){return this._waitForServices((function(t){return t.manager().connect()}))},e.authenticate=function(){var t=this;return this._waitForServices((function(t){return t.manager().authenticate()})).then((function(){t.isAuthenticated=!0}))},e._waitForServices=function(){var t=a(j.mark((function t(e){var n,i,o;return j.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._orderedServiceNames||(this._orderedServiceNames=z(r(this._services))),n=p(this._orderedServiceNames);case 2:if((i=n()).done){t.next=11;break}if(this._services[o=i.value]){t.next=7;break}throw new Error("No service for "+o);case 7:return t.next=9,e(this._services[o]);case 9:t.next=2;break;case 11:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),t}(),Y=function(){function t(t,e){var n=void 0===e?{}:e,r=n.services,i=void 0===r?{}:r,o=n.defaults,a=void 0===o?{}:o,c=n.disabled,s=void 0===c?{}:c;this._config=t,this._services=i,this._resolver={defaults:a,disabled:s}}var e=t.prototype;return e.supports=function(t){return!!this._services[t]},e.buildContainer=function(){var t=new U;for(var e in this._config){var n=P(e,this._config[e],this._resolver),r=n[0],i=n[1],o=void 0;if("object"==typeof r)o=r;else if("function"==typeof r)o=new r;else{if(!this.supports(r)&&"exchange"===e)throw new Error("This service has been extracted from dai.js. Please refer to the documentation to add it as a plugin: \n\n https://github.com/makerdao/dai.js/wiki/Basic-Usage-(Plugins)");if(!this.supports(r))throw new Error("Unsupported service in configuration: "+r);o=new this._services[r]}var a=o.manager().name();if(a!==e)throw new Error('Role mismatch: "'+a+'", "'+e+'"');o.manager().settings(i),t.register(o,e)}return this._registerDependencies(t),t.injectDependencies(),this._container=t,t},e._registerDependencies=function(t){var e=t.getRegisteredServiceNames(),r=e.reduce((function(e,r){var i=t.service(r).manager().dependencies();return n(e.concat(i))}),[]).filter((function(t){return!e.includes(t)}));if(0!==r.length){for(var i,o=p(r);!(i=o()).done;){var a=i.value,c=this._resolver.defaults[a];if("string"==typeof c&&(c=this._services[c]),!c)throw new Error('No service found for "'+a+'"');t.register(new c,a)}this._registerDependencies(t)}},e.service=function(t){return this._container||this.buildContainer(),this._container.service(t)},t}(),M=function(t){function e(e,n){return void 0===n&&(n=[]),t.call(this,g.LOCAL,e,n)||this}return c(e,t),e}(R),V=function(t){function e(e,n){return void 0===n&&(n=[]),t.call(this,g.PUBLIC,e,n)||this}return c(e,t),e}(R),H=function(t){function e(e,n){return void 0===n&&(n=[]),t.call(this,g.PRIVATE,e,n)||this}return c(e,t),e}(R);t.Container=U,t.LocalService=M,t.PrivateService=H,t.PublicService=V,t.ServiceManager=L,t.ServiceProvider=Y,t.StateMachine=y,t.standardizeConfig=P,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=services-core.umd.production.min.js.map
